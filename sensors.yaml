- platform: moon
- platform: template
  sensors:
    friendly_date:
      # Thursday June 10th, 2017
      friendly_name: "Today's Date"
      value_template: "{{ now().strftime('%A %B %e, %Y') }}"
    friendly_date_day:
      # Thu
      friendly_name: "Today's Day"
      value_template: "{{ now().strftime('%a') }}"
- platform: darksky
  api_key: !secret darksky_key
  monitored_conditions:
    - cloud_cover
    - summary
    - icon
    - temperature
    - apparent_temperature
    - precip_probability
    - humidity
    - daily_summary
    - hourly_summary
    - temperature_low
    - temperature_high
    - wind_bearing
  forecast:
    - 0
    - 1
    - 2
    - 3
    - 4
  scan_interval:
    minutes: 5
- platform: template
  sensors:
    tv_source:
      value_template: '{{ states.media_player.tv.attributes["source"] }}'
      friendly_name: 'TV Source'
- platform: history_stats
  name: Home this week
  entity_id: sensor.heating_tado_mode
  state: 'HOME'
  type: ratio
  start: '{{ as_timestamp( now().replace(hour=0).replace(minute=0).replace(second=0) ) - now().weekday() * 86400 }}'
  end: '{{ now() }}'
- platform: history_stats
  name: Away this week
  entity_id: sensor.heating_tado_mode
  state: 'AWAY'
  type: ratio
  start: '{{ as_timestamp( now().replace(hour=0).replace(minute=0).replace(second=0) ) - now().weekday() * 86400 }}'
  end: '{{ now() }}'
- platform: history_stats
  name: Heating ON this week
  entity_id: sensor.heating_power
  state: 'ON'
  type: ratio
  start: '{{ as_timestamp( now().replace(hour=0).replace(minute=0).replace(second=0) ) - now().weekday() * 86400 }}'
  end: '{{ now() }}'
- platform: history_stats
  name: Heating OFF this week
  entity_id: sensor.heating_power
  state: 'OFF'
  type: ratio
  start: '{{ as_timestamp( now().replace(hour=0).replace(minute=0).replace(second=0) ) - now().weekday() * 86400 }}'
  end: '{{ now() }}'
- platform: history_stats
  name: TV on this week
  entity_id: media_player.tv
  state: 'playing'
  type: ratio
  start: '{{ as_timestamp( now().replace(hour=0).replace(minute=0).replace(second=0) ) - now().weekday() * 86400 }}'
  end: '{{ now() }}'
- platform: template
  sensors:
    friendly_wind_direction:
      friendly_name: 'Wind Direction'
      value_template: >-
        {%if states.sensor.dark_sky_wind_bearing.state | float<=11 %}N
        {% elif states.sensor.dark_sky_wind_bearing.state | float>348 %}N
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=34 | float>11 %}NNE
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=56 | float>34 %}NE
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=79 | float>56 %}ENE
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=101 | float>79 %}E
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=124 | float>101 %}ESE
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=146 | float>124 %}SE
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=169 | float>146 %}SSE
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=191 | float>169 %}S
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=214 | float>191 %}SSW
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=236 | float>214 %}SW
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=259 | float>236 %}WSW
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=281 | float>259 %}W
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=304 | float>281 %}WNW
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=326 | float>304 %}NW
        {% elif states.sensor.dark_sky_wind_bearing.state | float<=348 | float>326 %}NNW
        {%- endif %}
- platform: template
  sensors:
    friendly_wind_direction_forecast:
      friendly_name: 'Wind Forecast'
      value_template: >-
        {%if states.sensor.dark_sky_wind_bearing_1.state | float<=11 %}N
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float>348 %}N
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=34 | float>11 %}NNE
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=56 | float>34 %}NE
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=79 | float>56 %}ENE
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=101 | float>79 %}E
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=124 | float>101 %}ESE
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=146 | float>124 %}SE
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=169 | float>146 %}SSE
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=191 | float>169 %}S
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=214 | float>191 %}SSW
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=236 | float>214 %}SW
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=259 | float>236 %}WSW
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=281 | float>259 %}W
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=304 | float>281 %}WNW
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=326 | float>304 %}NW
        {% elif states.sensor.dark_sky_wind_bearing_1.state | float<=348 | float>326 %}NNW
        {%- endif %}
# Sunset / Sunrise / Solar Elevation
- platform: template
  sensors:
    sunset_time:
      value_template: "{% set timestamp = as_timestamp(states.sun.sun.attributes.next_setting) | timestamp_custom('%I:%M') %} {{ timestamp.lstrip('0') }}"
      friendly_name: Sunset
      unit_of_measurement: PM
    sunrise_time:
      value_template: "{% set timestamp = as_timestamp(states.sun.sun.attributes.next_rising) | timestamp_custom('%I:%M') %} {{ timestamp.lstrip('0') }}"
      friendly_name: Sunrise
      unit_of_measurement: AM
    solar_angle:
      value_template: "{{ states.sun.sun.attributes.elevation }}"
      friendly_name: Solar Angle
      unit_of_measurement: degrees
